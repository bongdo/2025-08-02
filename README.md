# 2025-08-02

## Описание

Этот проект представляет собой веб-сервис для асинхронной загрузки файлов по URL, их архивации в zip-файл и предоставления ссылки для скачивания.

## Архитектура и паттерны

**Слоистая архитектура:** Приложение разделено на слои:
- `main.go`: Точка входа, инициализация сервера и зависимостей.
- `config`: Загрузка и предоставление конфигурации.
- `handlers`: Обработка HTTP-запросов, валидация и вызов бизнес-логики.
- `task`: Бизнес-логика, управление состоянием задач, загрузка и архивация 

**Веб-сервер:** Использовался стандартный пакет `net/http` в Go в сочетании с `gorilla/mux` для удобной маршрутизации.

**Управление задачами:** Для управления состоянием задач используется `TaskManager`, которая хранит задачи в мапе. Доступ к этой мапе синхронизируется с помощью `sync.Mutex` чтобы не было race condition.

**Ограничение параллелизма:** Для ограничения количества одновременно выполняемых задач по архивации (не более трех) используется семафор, реализованный на основе буферизованного канала Go (`chan struct{}`).

**Асинхронная обработка:** Загрузка файлов и создание архива выполняются в отдельных горутинах, что позволяет не блокировать основной поток.

**Конфигурация:** Параметры сервера (порт, разрешенные расширения, лимиты) вынесены в отдельный файл `config.json`.

**Graceful Shutdown:** Реализовано плавное завершение для корректной обработки текущих запросов при остановке.

**Логирование:** В ключевые моменты работы приложения добавлено логирование для отслеживания процесса выполнения запросов.

**Документация API:** Для интерактивной документации используется Swagger.

## API

`POST /tasks`: Создает новую задачу для архивации.

`POST /tasks/{id}/files`: Добавляет URL файла в задачу. Когда количество файлов достигает лимита (3), запускается процесс архивации.

`GET /tasks/{id}`: Возвращает статус задачи. Если задача выполнена, в ответе будет ссылка на скачивание архива.

`GET /archives/{archive_name.zip}`: Позволяет скачать готовый архив.

### Swagger-документация

После запуска сервера, интерактивная документация Swagger UI доступна по адресу:

[http://localhost:8080/swagger/index.html](http://localhost:8080/swagger/index.html)

## Запуск

1.  **Установка зависимостей:**

    `go mod tidy`

2.  **Запуск сервера:**

    `go run main.go`

Сервер будет запущен на порту 8080 по умолчанию.
